<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng nh·∫≠p</title>
    <link rel="stylesheet" href="../assets/css/account.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1 class="card-title">ƒêƒÉng nh·∫≠p</h1>
                <p class="card-description">Nh·∫≠p th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa b·∫°n ƒë·ªÉ ti·∫øp t·ª•c</p>
            </div>
            <div class="card-content">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">T√™n ƒëƒÉng nh·∫≠p</label>
                        <input type="text" id="username" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" required>
                        <span class="error-message" id="usernameError"></span>
                    </div>
                    <div class="form-group">
                        <div class="password-header">
                            <label for="password">M·∫≠t kh·∫©u</label>
                            <a href="#" class="forgot-password">Qu√™n m·∫≠t kh·∫©u?</a>
                        </div>
                        <input type="password" id="password" required>
                        <span class="error-message" id="passwordError"></span>
                    </div>
                    <button type="submit" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
                </form>
            </div>
            <div class="card-footer">
                <div class="divider">
                    <span>Ho·∫∑c</span>
                </div>
                <p class="register-link">
                    Ch∆∞a c√≥ t√†i kho·∫£n?
                    <a href="register.html">
                        ƒêƒÉng k√Ω ngay
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon">
                            <path d="M5 12h14"></path>
                            <path d="m12 5 7 7-7 7"></path>
                        </svg>
                    </a>
                </p>
            </div>
        </div>
    </div>
    <!-- SweetAlert2 CDN n·∫øu ch∆∞a c√≥ -->

    <script>
        // H√†m hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng v√† chuy·ªÉn trang
        function showLoginSuccessAndRedirect(role) {
            let targetUrl;

            if (role === 1) {
                // Admin
                targetUrl = "http://127.0.0.1:5501/LayoutAdmin/dashboard.html";
            } else if (role === 0 || role === 2) {
                // User th∆∞·ªùng (ho·∫∑c c√°c quy·ªÅn kh√°c)
                targetUrl = "http://127.0.0.1:5501/LayoutIndex/index.html";
            } else {
                // Role kh√¥ng x√°c ƒë·ªãnh
                Swal.fire({
                    icon: 'error',
                    title: 'L·ªói ph√¢n quy·ªÅn',
                    text: 'T√†i kho·∫£n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p h·ª£p l·ªá.',
                });
                return;
            }

            Swal.fire({
                icon: 'success',
                title: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng!',
                text: 'Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i üéâ',
                timer: 2000,
                showConfirmButton: false
            }).then(() => {
                window.location.href = targetUrl;
            });
        }

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o ƒëƒÉng nh·∫≠p th·∫•t b·∫°i
        function showLoginFailed(message) {
            Swal.fire({
                icon: 'error',
                title: 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i',
                text: message || 'T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng',
                footer: 'Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c li√™n h·ªá h·ªó tr·ª£.'
            });
        }

        // X·ª≠ l√Ω khi submit form
        document.getElementById("loginForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();

            // Ki·ªÉm tra tr·ªëng
            if (!username || !password) {
                showLoginFailed("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u.");
                return;
            }

            // G·ª≠i request ƒëƒÉng nh·∫≠p
            fetch("https://localhost:7186/api/Auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ username, password })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.token && data.role !== undefined) {
                        // L∆∞u th√¥ng tin v√†o localStorage
                        localStorage.setItem("token", data.token);
                        localStorage.setItem("userId", data.id);
                        localStorage.setItem("username", data.username);
                        localStorage.setItem("role", data.role);

                        // G·ªçi h√†m x·ª≠ l√Ω ƒëi·ªÅu h∆∞·ªõng theo role
                        showLoginSuccessAndRedirect(data.role);
                    } else {
                        showLoginFailed(data.message || "Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá.");
                    }
                })
                .catch(error => {
                    console.error("L·ªói ƒëƒÉng nh·∫≠p:", error);
                    showLoginFailed("L·ªói k·∫øt n·ªëi ho·∫∑c m√°y ch·ªß kh√¥ng ph·∫£n h·ªìi.");
                });
        });

    </script>



</body>

</html>