<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <!-- <link rel="stylesheet" href="../assets/css/base.css"> -->
  <link rel="stylesheet" href="../assets/css/grid.css" />
  <link rel="stylesheet" href="../assets/fonts/fontawesome-free-6.5.2-web/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <title>Movie</title>
</head>

<body>

  <div class="app">

    <div class="header">
      <div class="header__left">
        <a href="">
          <img class="header__logo" src="../assets/img/logo/logo.png" alt="netflix-font" />
        </a>
        <nav class="header__directory">
          <a href="index.html" class="header__directory-link active">Trang ch·ªß</a>
          <a href="movie.html" class="header__directory-link">Phim</a>
          <a href="#" class="header__directory-link">M·ªõi & Ph·ªï bi·∫øn</a>
          <a href="favorites.html" class="header__directory-link">Danh s√°ch c·ªßa t√¥i</a>
          <a href="#" class="header__directory-link">Duy·ªát t√¨m theo ng√¥n ng·ªØ</a>
        </nav>
      </div>
      <div class="header__right">
        <div class="header__icon">
          <div class="header__icon-search">
            <input type="text" class="header__icon-input" placeholder="T√¨m Ki·∫øm Phim Mu·ªën Xem" />
            <button class="header__icon-btn">
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
          <a class="header__icon-bell" href="">
            <i class="fa-regular fa-bell"></i>
          </a>
        </div>
        <div class="header__button">
          <button class="header__register" style="color: azure;">Register</button>
          <button class="header__login"><span style="color: azure;">Login</span></button>
        </div>
        <div id="userInfo" style="display: none;">
          <span>üë§ <strong id="usernameDisplay"></strong></span>
          <button id="logoutBtn" style="margin-left: 8px;">ƒêƒÉng xu·∫•t</button>
        </div>
        <div class="header__user">
          <img src="../assets/img/banner/one piece red/One_Piece_Film-_Red_-_√Åp_ph√≠ch_Vi·ªát_Nam.jpg" alt="" />
          <p>Admin</p>
        </div>
        <div class="header__user-setting">
          <ul>
            <li><a href="">Th√¥ng Tin T√†i Kho·∫£n</a></li>
            <li><a href="">Danh s√°ch phim y√™u th√≠ch</a></li>
            <li><a href="">ƒê·ªïi m·∫≠t kh·∫©u</a></li>
            <li><a href="">ƒêƒÉng xu·∫•t</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="app_main">
      <div class="main__screen-container">
        <iframe src="https://embed1.streamc.xyz/embed.php?hash=8a7dc71f6ad631c2685d467bf2927f97"
          frameborder="0"></iframe>
      </div>
      <div class="main__description-container" id="api-information">

      </div>


      <div class="abc">
        <button class="button" id="addMovieFavorite">
          <i class="fa-solid fa-plus"></i>
          <span>Th√™m V√†o Danh S√°ch</span>
        </button>
      </div>

      <!-- Ph·∫ßn b√¨nh lu·∫≠n - Th√™m ngay sau div class="content-details" trong div class="content-box" -->
      <div class="comment-section">
        <h3 class="comment-section-title">B√¨nh lu·∫≠n</h3>

        <!-- Form b√¨nh lu·∫≠n -->
        <div class="comment-form">
          <div class="comment-form-avatar">
            <img src="https://ui-avatars.com/api/?name=User&background=random&color=fff" alt="Avatar">
          </div>
          <div class="comment-form-content">
            <textarea id="commentText" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n v·ªÅ b·ªô phim..."></textarea>
            <div class="comment-form-actions">
              <button id="submitComment" class="btn-comment">G·ª≠i b√¨nh lu·∫≠n</button>
            </div>
          </div>
        </div>

        <!-- Danh s√°ch b√¨nh lu·∫≠n -->
        <div class="comment-list" style="color : white">
          <!-- B√¨nh lu·∫≠n s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
        </div>

        <!-- N√∫t xem th√™m b√¨nh lu·∫≠n -->
        <div class="comment-load-more">
          <button id="loadMoreComments" class="btn-load-more">Xem th√™m b√¨nh lu·∫≠n</button>
        </div>
      </div>





      <div class="row_posters">
        <div class="content__main-title">
          <h3 class="content__main-title-left">C√≥ th·ªÉ b·∫°n s·∫Ω th√≠ch</h3>
          <h4 class="content__main-title-right">
            <a href="">Xem T·∫•t C·∫£</a>
          </h4>
        </div>
        <div class="content__main-posters">
          <div class="content__main-icon left">
            <i class="fa-solid fa-chevron-left"></i>
          </div>
          <div class="content__main-posters-row">
            <div class="moviesposter-wrapper">
              <a href="https://embed1.streamc.xyz/embed.php?hash=8a7dc71f6ad631c2685d467bf2927f97">
                <img src="../assets/img/banner/one piece red/One_Piece_Film-_Red_-_√Åp_ph√≠ch_Vi·ªát_Nam.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">One Piece Flim Red</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed1.streamc.xyz/embed.php?hash=1f16e30d78accee133bc9495ffc6bae4">
                <img src="https://phim.nguonc.com/public/images/Film/1542.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">T√™n c·∫≠u l√† g√¨?</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed.streamc.xyz/embed.php?hash=7719391cf2dfb7b112bc381b058d5e76">
                <img src="https://phim.nguonc.com/public/images/Film/2ndvx03fmREMxEgaZ1vWt756TOQ.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">Ch√∫ Thu·∫≠t H·ªìi Chi·∫øn 0</h3>
              <div class="moviesposter-practice">1/100</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed1.streamc.xyz/embed.php?hash=4438c2dbc49f1182cfa3e732b8789fb0">
                <img src="https://phim.nguonc.com/public/images/Film/143101.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">
                T√¥i S·∫Ω ƒê·ª° H·∫øt M·ªçi Th·ª©: Ng∆∞·ªùi M·∫°nh Nh·∫•t Th·∫ø Gi·ªõi V·ªõi Hi·ªÉu L·∫ßm
                Ng∆∞·ª£c ƒê·ªùi Mu·ªën L√†m M·∫°o Hi·ªÉm Gi·∫£
              </h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=3c77d894817fc54116f9edef839c8715">
                <img src="https://phim.nguonc.com/public/images/Post/6/tu-hom-nay-den-luot-toi.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">T·ª´ h√¥m nay, ƒë·∫øn l∆∞·ª£t t√¥i!</h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed3.streamc.xyz/embed.php?hash=b9cfc0fc1f53d688acc19f1026ffae9a">
                <img src="https://phim.nguonc.com/public/images/Film/13-phut-song-con-thumb.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">13 Ph√∫t S·ªëng C√≤n</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=a3bb56eb7d9a3c5487003ea937b5654a">
                <img src="https://phim.nguonc.com/public/images/Film/uEpFxsBse6JY4OztlsuyAQoGszy.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">V√¢y H√£m Tr√™n Kh√¥ng</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=31e9138e79803241ac0ef7449ae6360d">
                <img src="https://phim.nguonc.com/public/images/Film/4MRpQe6zhoKc792Bbrqmp3FjdaY.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">C√° M·∫≠p Kh√¥ng Gian</h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=02720fcc26a34d4b570f248f4edaf86b">
                <img src="https://phim.nguonc.com/public/images/Film/j6d2GmScaSExdhMxFOfRhk36exu.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">
                Sekai ga Horobiru Mae ni Kimi ni Aitai
              </h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
          </div>
          <div class="content__main-icon right">
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </div>
      </div>
      <div class="row_posters">
        <div class="content__main-title">
          <h3 class="content__main-title-left">C√≥ th·ªÉ b·∫°n s·∫Ω th√≠ch</h3>
          <h4 class="content__main-title-right">
            <a href="">Xem T·∫•t C·∫£</a>
          </h4>
        </div>
        <div class="content__main-posters">
          <div class="content__main-icon left">
            <i class="fa-solid fa-chevron-left"></i>
          </div>
          <div class="content__main-posters-row">
            <div class="moviesposter-wrapper">
              <a href="https://embed1.streamc.xyz/embed.php?hash=8a7dc71f6ad631c2685d467bf2927f97">
                <img src="../assets/img/banner/one piece red/One_Piece_Film-_Red_-_√Åp_ph√≠ch_Vi·ªát_Nam.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">One Piece Flim Red</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed1.streamc.xyz/embed.php?hash=1f16e30d78accee133bc9495ffc6bae4">
                <img src="https://phim.nguonc.com/public/images/Film/1542.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">T√™n c·∫≠u l√† g√¨?</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed.streamc.xyz/embed.php?hash=7719391cf2dfb7b112bc381b058d5e76">
                <img src="https://phim.nguonc.com/public/images/Film/2ndvx03fmREMxEgaZ1vWt756TOQ.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">Ch√∫ Thu·∫≠t H·ªìi Chi·∫øn 0</h3>
              <div class="moviesposter-practice">1/100</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed1.streamc.xyz/embed.php?hash=4438c2dbc49f1182cfa3e732b8789fb0">
                <img src="https://phim.nguonc.com/public/images/Film/143101.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">
                T√¥i S·∫Ω ƒê·ª° H·∫øt M·ªçi Th·ª©: Ng∆∞·ªùi M·∫°nh Nh·∫•t Th·∫ø Gi·ªõi V·ªõi Hi·ªÉu L·∫ßm
                Ng∆∞·ª£c ƒê·ªùi Mu·ªën L√†m M·∫°o Hi·ªÉm Gi·∫£
              </h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=3c77d894817fc54116f9edef839c8715">
                <img src="https://phim.nguonc.com/public/images/Post/6/tu-hom-nay-den-luot-toi.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">T·ª´ h√¥m nay, ƒë·∫øn l∆∞·ª£t t√¥i!</h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed3.streamc.xyz/embed.php?hash=b9cfc0fc1f53d688acc19f1026ffae9a">
                <img src="https://phim.nguonc.com/public/images/Film/13-phut-song-con-thumb.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">13 Ph√∫t S·ªëng C√≤n</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=a3bb56eb7d9a3c5487003ea937b5654a">
                <img src="https://phim.nguonc.com/public/images/Film/uEpFxsBse6JY4OztlsuyAQoGszy.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">V√¢y H√£m Tr√™n Kh√¥ng</h3>
              <div class="moviesposter-practice">1/1</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=31e9138e79803241ac0ef7449ae6360d">
                <img src="https://phim.nguonc.com/public/images/Film/4MRpQe6zhoKc792Bbrqmp3FjdaY.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">C√° M·∫≠p Kh√¥ng Gian</h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
            <div class="moviesposter-wrapper">
              <a href="https://embed4.streamc.xyz/embed.php?hash=02720fcc26a34d4b570f248f4edaf86b">
                <img src="https://phim.nguonc.com/public/images/Film/j6d2GmScaSExdhMxFOfRhk36exu.jpg" alt="" />
              </a>
              <h3 class="moviesposter-title">
                Sekai ga Horobiru Mae ni Kimi ni Aitai
              </h3>
              <div class="moviesposter-practice">1/10</div>
              <div class="moviesposter-HD">HD</div>
            </div>
          </div>
          <div class="content__main-icon right">
            <i class="fa-solid fa-chevron-right"></i>
          </div>
        </div>
      </div>

    </div>

    <div class="footer">
      <div class="grid wide">
        <div class="row">
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">ChƒÉm s√≥c kh√°ch h√†ng</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Trung T√¢m Tr·ª£ Gi√∫p</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Quy·ªÅn Ri√™ng T∆∞</a>
              </li>
            </ul>
          </div>
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">V·ªÅ MoVie</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Gi·ªõi Thi·ªáu V·ªÅ MovieMovie Vi·ªát Nam</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">ƒêi·ªÅu Kho·∫£n Movie</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Li√™n H·ªá V·ªõi Truy·ªÅn Th√¥ng</a>
              </li>
            </ul>
          </div>
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">Gi·ªõi Thi·ªáu</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-facebook"></i>Facebook</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-instagram"></i>Instagram</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-linkedin"></i>LinkedIn</a>
              </li>
            </ul>
          </div>
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">Theo d√µi</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-facebook"></i>Facebook</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-instagram"></i>Instagram</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-linkedin"></i>LinkedIn</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer__bottom">
        <div class="grid wide">
          <p class="footer-text">
            ¬© 2024 - B·∫£n quy·ªÅn thu·ªôc v·ªÅ C√¥ng ty TNHH Movie
          </p>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="../assets/js/main.js"></script>
<script>



  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');

  function fetchMovies() {
    if (!id) {
      console.error("ID phim kh√¥ng t·ªìn t·∫°i!");
      let testApiEl = document.getElementById('api-information');
      if (testApiEl) {
        testApiEl.innerHTML = `<p class="error-message">Kh√¥ng t√¨m th·∫•y ID phim.</p>`;
      }
      return;
    }

    var apiUrl = `https://localhost:7186/api/Movie/${id}`;

    fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(movie => {
        // Ki·ªÉm tra n·∫øu response kh√¥ng ph·∫£i object h·ª£p l·ªá
        if (!movie || typeof movie !== "object") {
          throw new Error("Invalid response format. Expected an object.");
        }

        var html1 = `
                <div class="img-box">
                    <img src="${movie.poster}" alt="">
                </div>
                <div class="content-box">
                    <div class="content-heading">
                        <h3 class="title">${movie.title}</h3>
                    </div>
                    <div class="content-base-infor">
                        <div class="base-infor"><p>${movie.releaseYear}</p></div>
                        <div class="base-infor"><p>HOT</p></div>
                        <div class="time">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                                width="1em" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path>
                                <path d="M13 7h-2v5.414l3.293 3.293 1.414-1.414L13 11.586z"></path>
                            </svg>
                            <p>${movie.duration} ph√∫t</p>
                        </div>
                        <div class="view">
                            
                            <div class="base-infor"><p>18+</p></div>
                        </div>
                    </div>
                    <div class="content-description">
                        <p>${movie.description}</p>
                    </div>
                    <div class="content-details">
                        <div class="item"><p>Qu·ªëc Gia :</p><span>${movie.country}</span></div>
                        <div class="item"><p>Th·ªÉ Lo·∫°i :</p><span>${movie.genres}</span></div>
                        <div class="item"><p>ƒê·∫°o Di·ªÖn :</p><span>${movie.director}</span></div>
                        <div class="item"><p>Di·ªÖn Vi√™n :</p><span>${movie.actors}</span></div>
                    </div>
                </div>`;

        let testApiEl = document.getElementById('api-information');
        if (testApiEl) {
          testApiEl.innerHTML = html1;
        } else {
          console.error("Element with ID 'api-information' not found.");
        }
      })
      .catch(error => {
        console.error("Error fetching movie:", error);
        let testApiEl = document.getElementById('api-information');
        if (testApiEl) {
          testApiEl.innerHTML = `<p class="error-message">Kh√¥ng th·ªÉ t·∫£i phim. Vui l√≤ng th·ª≠ l·∫°i sau.</p>`;
        }
      });
  }

  // G·ªçi h√†m ƒë·ªÉ l·∫•y phim
  fetchMovies();

</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const addFavoriteButton = document.getElementById("addMovieFavorite");

    if (!addFavoriteButton) return;

    addFavoriteButton.addEventListener("click", function () {
      const token = localStorage.getItem("token");
      const userId = parseInt(localStorage.getItem("userId"));  // √©p ki·ªÉu cho ch·∫Øc
      const movieId = parseInt(getMovieId());  // L·∫•y id t·ª´ URL

      // Debug (b·∫°n c√≥ th·ªÉ m·ªü console ƒë·ªÉ xem)
      console.log("Token:", token);
      console.log("User ID:", userId);
      console.log("Movie ID:", movieId);

      // Ki·ªÉm tra n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p
      if (!token || !userId) {
        Swal.fire({
          icon: "info",
          title: "B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p",
          text: "H√£y ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m phim v√†o danh s√°ch y√™u th√≠ch.",
          confirmButtonText: "ƒêƒÉng nh·∫≠p"
        }).then(() => {
          window.location.href = "../Account/login.html";
        });
        return;
      }

      // Ki·ªÉm tra n·∫øu kh√¥ng c√≥ movieId
      if (!movieId) {
        Swal.fire({
          icon: "warning",
          title: "Kh√¥ng t√¨m th·∫•y phim!",
          text: "Vui l√≤ng ki·ªÉm tra l·∫°i URL.",
        });
        return;
      }

      // G·ª≠i request ƒë·∫øn API
      fetch("https://localhost:7186/api/Movie/add-to-favorites", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          userId: userId,
          movieId: movieId
        })
      })
        .then(response => {
          if (!response.ok) {
            // ƒê·ªçc l·ªói d·∫°ng text n·∫øu c√≥
            return response.text().then(errText => {
              throw new Error(`L·ªói ${response.status}: ${errText}`);
            });
          }
          return response.text(); // n·∫øu server tr·∫£ text
        })
        .then(message => {
          console.log("‚úÖ Server response:", message);
          Swal.fire({
            icon: "success",
            title: "Th√†nh c√¥ng!",
            text: message || "Phim ƒë√£ ƒë∆∞·ª£c th√™m v√†o danh s√°ch y√™u th√≠ch.",
            timer: 2000,
            showConfirmButton: false
          });
        })
        .catch(error => {
          console.error("‚ùå L·ªói:", error.message);
          Swal.fire({
            icon: "error",
            title: "Kh√¥ng th·ªÉ th√™m v√†o y√™u th√≠ch!",
            text: error.message
          });
        });
    });
  });

  // üîß H√†m l·∫•y movieId t·ª´ URL (?id=xxx)
  function getMovieId() {
    const params = new URLSearchParams(window.location.search);
    return params.get("id");
  }
</script>


<script>

  const token = localStorage.getItem("token");
  // const movieId = localStorage.getItem("userId");  // ID b·ªô phim m√† b·∫°n ƒëang hi·ªÉn th·ªã b√¨nh lu·∫≠n
  const userId = localStorage.getItem("userId");
  const movieId = getMovieId(); // L·∫•y movieId t·ª´ URL
  // const userId = 1;
  // H√†m ƒë·ªÉ l·∫•y v√† hi·ªÉn th·ªã b√¨nh lu·∫≠n cho b·ªô phim
  function loadComments(page = 1) {
    fetch(`https://localhost:7186/api/Comment/movie/${movieId}/comments?page=${page}&limit=10`, {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      }
    })
      .then(response => response.json())
      .then(data => {
        if (Array.isArray(data) && data.length > 0) {
          const commentList = document.querySelector(".comment-list");

          commentList.innerHTML = ""; // X√≥a c√°c b√¨nh lu·∫≠n c≈© tr∆∞·ªõc khi th√™m m·ªõi

          data.forEach(comment => {
            const avatarUrl = comment.Avatar
              ? comment.Avatar
              : `https://api.dicebear.com/7.x/thumbs/svg?seed=${encodeURIComponent(comment.userName)}&background=random&size=64`;
            const newComment = document.createElement("div");
            newComment.classList.add("comment-item");
            newComment.innerHTML = `
                          <div class="comment-user-avatar">
                              <img src="${avatarUrl}" alt="Avatar">
                          </div>
                          <div class="comment-content  style="color : white">
                              <strong style="color : white">${comment.userName}</strong>: ${comment.content}
                              <p><small>ƒê√£ ƒëƒÉng v√†o: ${new Date(comment.createdAt).toLocaleString()}</small></p>
                          </div>
                      `;
            commentList.appendChild(newComment);
          });
        } else {
          Swal.fire({
            icon: 'info',
            title: 'Kh√¥ng c√≥ th√™m b√¨nh lu·∫≠n n√†o!',
            timer: 2000,
            showConfirmButton: false
          });
        }

      })
      .catch(error => {
        console.error("Error:", error);
        alert("Kh√¥ng th·ªÉ t·∫£i b√¨nh lu·∫≠n.");
      });

  }

  // G·ªçi h√†m ƒë·ªÉ t·∫£i b√¨nh lu·∫≠n khi trang ƒë∆∞·ª£c t·∫£i
  loadComments();

  // X·ª≠ l√Ω khi ng∆∞·ªùi d√πng b·∫•m "Xem th√™m b√¨nh lu·∫≠n"
  document.getElementById("loadMoreComments").addEventListener("click", function () {
    const currentPage = document.querySelectorAll(".comment-item").length / 10 + 1;
    loadComments(currentPage); // T·∫£i th√™m b√¨nh lu·∫≠n
  });

  // X·ª≠ l√Ω khi ng∆∞·ªùi d√πng g·ª≠i b√¨nh lu·∫≠n
  document.getElementById("submitComment").addEventListener("click", function (e) {
    e.preventDefault();

    if (!token) {
      Swal.fire({
        icon: 'info',
        title: 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p',
        text: 'Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ g·ª≠i b√¨nh lu·∫≠n.',
        confirmButtonText: 'ƒêƒÉng nh·∫≠p',
      }).then(() => {
        window.location.href = "../Account/login.html"; // ƒë∆∞·ªùng d·∫´n ƒë·∫øn trang login
      });
      return;
    }


    const commentText = document.getElementById("commentText").value.trim();

    if (!commentText) {
      Swal.fire({
        icon: 'warning',
        title: '√îi!',
        text: 'Vui l√≤ng nh·∫≠p n·ªôi dung b√¨nh lu·∫≠n tr∆∞·ªõc khi g·ª≠i.',
      });
      return;
    }


    fetch("https://localhost:7186/api/Comment", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`,
      },
      body: JSON.stringify({
        movieId: movieId,
        userId: userId,  // Gi·∫£ s·ª≠ userId l√† 1, b·∫°n c√≥ th·ªÉ thay b·∫±ng ID ng∆∞·ªùi d√πng t·ª´ token
        content: commentText,
        createdAt: new Date().toISOString()
      })
    })
      .then(response => response.json())
      .then(data => {

        document.getElementById("commentText").value = "";
        Swal.fire({
          icon: 'success',
          title: 'G·ª≠i th√†nh c√¥ng!',
          text: 'C·∫£m ∆°n b·∫°n ƒë√£ ƒë·ªÉ l·∫°i b√¨nh lu·∫≠n.',
          timer: 2000,
          showConfirmButton: false
        });
        loadComments();

      })
      .catch(error => {
        console.error("Error:", error);
        Swal.fire({
          icon: 'error',
          title: 'G·ª≠i th·∫•t b·∫°i',
          text: 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ th·ª±c hi·ªán ch·ª©c nƒÉng n√†y.',
        });

      });
  });


  function getMovieId() {
    const params = new URLSearchParams(window.location.search);
    return params.get('id'); // Thay ƒë·ªïi n·∫øu URL ch·ª©a tham s·ªë kh√°c

  }
</script>
<script src="../assets/js/account.js"></script>



</html>