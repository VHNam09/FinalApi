<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <link rel="stylesheet" href="../assets/css/grid.css" />
  <link rel="stylesheet" href="../assets/fonts/fontawesome-free-6.5.2-web/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <title>Movie</title>
</head>

<body>
  <div class="app">
    <div class="header">
      <div class="header__left">
        <a href="">
          <img class="header__logo" src="../assets/img/logo/logo.png" alt="netflix-font" />
        </a>
        <nav class="header__directory">
          <a href="index.html" class="header__directory-link active">Trang ch·ªß</a>
          <a href="movie.html" class="header__directory-link">Phim</a>
          <a href="#" class="header__directory-link">M·ªõi & Ph·ªï bi·∫øn</a>
          <a href="favorites.html" class="header__directory-link">Danh s√°ch c·ªßa t√¥i</a>
          <a href="#" class="header__directory-link">Duy·ªát t√¨m theo ng√¥n ng·ªØ</a>
        </nav>
      </div>
      <div class="header__right">
        <div class="header__icon">
          <div class="header__icon-search">
            <input type="text" class="header__icon-input" placeholder="T√¨m Ki·∫øm Phim Mu·ªën Xem" />
            <button class="header__icon-btn">
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
          <a class="header__icon-bell" href="">
            <i class="fa-regular fa-bell"></i>
          </a>
        </div>
        <div class="header__button">
          <button class="header__register" style="color: azure;">Register</button>
          <button class="header__login"><span style="color: azure;">Login</span></button>
        </div>
        <div id="userInfo" style="display: none;">
          <span>üë§ <strong id="usernameDisplay"></strong></span>
          <button id="logoutBtn" style="margin-left: 8px;">ƒêƒÉng xu·∫•t</button>
        </div>
        <div class="header__user">
          <img src="../assets/img/banner/one piece red/One_Piece_Film-_Red_-_√Åp_ph√≠ch_Vi·ªát_Nam.jpg" alt="" />
          <p>Admin</p>
        </div>
        <div class="header__user-setting">
          <ul>
            <li><a href="">Th√¥ng Tin T√†i Kho·∫£n</a></li>
            <li><a href="">Danh s√°ch phim y√™u th√≠ch</a></li>
            <li><a href="">ƒê·ªïi m·∫≠t kh·∫©u</a></li>
            <li><a href="">ƒêƒÉng xu·∫•t</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="app_main">
      <div class="grid wide container">
        <div>
          <h2 id="welcomeMessage" style="padding-top: 100px; color: azure;font-family: cursive; font-size: larger;">
          </h2>
        </div>
        <div class="row main_container" id="test-api">
          <!-- Hi·ªán Phim qua Api -->
        </div>
      </div>
      <div class="pagging__container">
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            <i class="pagination-item__icon fa-solid fa-arrow-left"></i>
          </a>
        </li>
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            1
          </a>
        </li>
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            2
          </a>
        </li>
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            3
          </a>
        </li>
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            ...
          </a>
        </li>
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            15
          </a>
        </li>
        <li class="pagging__cotainer-items">
          <a class="pagging__container-link">
            <i class="pagination-item__icon fa-solid fa-arrow-right"></i>
          </a>
        </li>

      </div>

    </div>

    <div class="footer">
      <div class="grid wide">
        <div class="row">
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">ChƒÉm s√≥c kh√°ch h√†ng</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Trung T√¢m Tr·ª£ Gi√∫p</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Quy·ªÅn Ri√™ng T∆∞</a>
              </li>
            </ul>
          </div>
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">V·ªÅ MoVie</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Gi·ªõi Thi·ªáu V·ªÅ MovieMovie Vi·ªát Nam</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">ƒêi·ªÅu Kho·∫£n Movie</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link">Li√™n H·ªá V·ªõi Truy·ªÅn Th√¥ng</a>
              </li>
            </ul>
          </div>
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">Gi·ªõi Thi·ªáu</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-facebook"></i>Facebook</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-instagram"></i>Instagram</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-linkedin"></i>LinkedIn</a>
              </li>
            </ul>
          </div>
          <div class="col l-3 m-4 c-6">
            <h3 class="footer__heading">Theo d√µi</h3>
            <ul class="footer__list">
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-facebook"></i>Facebook</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-instagram"></i>Instagram</a>
              </li>
              <li class="footer__list-items">
                <a href="" class="footer__list-items link"><i
                    class="footer__list-items-icon fa-brands fa-linkedin"></i>LinkedIn</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer__bottom">
        <div class="grid wide">
          <p class="footer-text">
            ¬© 2024 - B·∫£n quy·ªÅn thu·ªôc v·ªÅ C√¥ng ty TNHH Movie
          </p>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="../assets/js/main.js"></script>
<script src="../assets/js/account.js"></script>






<script>
  document.addEventListener("DOMContentLoaded", function () {
    const token = localStorage.getItem("token");
    const username = localStorage.getItem("username");
    const userId = localStorage.getItem("userId");  // ‚ú® Th√™m d√≤ng n√†y ƒë·ªÉ l·∫•y userId t·ª´ localStorage

    if (!token) {
      Swal.fire({
        icon: 'info',
        title: 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p',
        text: 'Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y.',
        confirmButtonText: 'ƒêƒÉng nh·∫≠p ngay',
        showCancelButton: true,
        cancelButtonText: 'ƒê·ªÉ sau'
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = "http://127.0.0.1:5501/Account/login.html";
        }
        else {

          window.location.href = "http://127.0.0.1:5501/LayoutIndex/index.html";
        }
      });
      return;
    }


    const welcomeElement = document.getElementById("welcomeMessage");
    if (welcomeElement && username) {
      welcomeElement.innerText = `Danh s√°ch phim y√™u th√≠ch c·ªßa: ${username}`;
    }

    fetchMovies(userId);  // ‚ú® Truy·ªÅn userId v√†o h√†m fetchMovies
  });

  function fetchMovies(userId) {
    var apiUrl = `https://localhost:7186/api/Movie/favorites/${userId}`;

    fetch(apiUrl, {
      headers: {
        "Authorization": "Bearer " + localStorage.getItem("token"), // ‚ú® N√™n th√™m Authorization cho an to√†n
        "Content-Type": "application/json"
      }
    })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(movies => {
        if (!Array.isArray(movies)) {
          throw new Error("Invalid response format. Expected an array.");
        }

        var html1 = movies.map(movie => `
            <div class="col c-6 m-3 l-2 moviesposter-wrapper">
                <a href="${movie.trailerUrl}" target="_blank">
                    <img src="${movie.poster}" alt="${movie.title}" />
                </a>
                <h3 class="moviesposter-title">${movie.title}</h3>
                <div class="moviesposter-practice">1/1</div>
                <div class="moviesposter-HD">HD</div>
            </div>
        `).join("");

        let testApiEl = document.getElementById('test-api');
        if (testApiEl) {
          testApiEl.innerHTML = html1;
        } else {
          console.error("Element with ID 'test-api' not found.");
        }
      })
      .catch(error => {
        console.error("Error fetching movies:", error);
        let testApiEl = document.getElementById('test-api');
        if (testApiEl) {
          testApiEl.innerHTML = `<p class="error-message">Failed to load movies. Please try again later.</p>`;
        }
      });
  }
</script>




</html>