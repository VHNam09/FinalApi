<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/admin/movies.css" />
    <title>NOTFLEX Admin - Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</title>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="menu-toggle">‚ò∞</div>
        <a href="dashboard.html" class="logo">NOTFLEX</a>
        <div class="header-title">Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</div>
        <div class="user-menu">
            <a href="#">Admin</a>
            <a href="#">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-menu">
                <div class="menu-title">Qu·∫£n l√Ω n·ªôi dung</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fa fa-dashboard">üìä</i> Dashboard
                </a>
                <a href="movies.html" class="menu-item">
                    <i class="fa fa-film">üé¨</i> Phim
                </a>
                <a href="genres.html" class="menu-item">
                    <i class="fa fa-tags">üè∑Ô∏è</i> Th·ªÉ lo·∫°i
                </a>

                <div class="menu-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
                <a href="users.html" class="menu-item active">
                    <i class="fa fa-users">üë•</i> Users
                </a>
                <a href="roles.html" class="menu-item">
                    <i class="fa fa-lock">üîí</i> Role
                </a>

                <div class="menu-title">H·ªá th·ªëng</div>
                <a href="settings.html" class="menu-item">
                    <i class="fa fa-cog">‚öôÔ∏è</i> C√†i ƒë·∫∑t
                </a>
                <a href="statistics.html" class="menu-item">
                    <i class="fa fa-bar-chart">üìà</i> Th·ªëng k√™
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-title">
                <h1>Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h1>
                <button class="btn"><a href="user-add.html" style="color: aliceblue;">Th√™m Admin m·ªõi</a></button>
            </div>

            <div class="filters">
                <div class="search-box">
                    <i class="fa fa-search">üîç</i>
                    <input type="text" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng..." id="search-input">
                </div>
                <select id="role-filter" class="filter-select">
                    <option value="">T·∫•t c·∫£ vai tr√≤</option>
                    <option value="Admin">Admin</option>
                    <option value="User">User</option>

                </select>
                <!-- <select class="filter-select">
                     <option>T·∫•t c·∫£ tr·∫°ng th√°i</option> -->
                <!-- <option>Ho·∫°t ƒë·ªông</option> -->
                <!-- <option>B·ªã kh√≥a</option> -->
                <!-- </select> -->
                <!-- <select class="filter-select">
                    <option>S·∫Øp x·∫øp theo</option>
                    <option>M·ªõi nh·∫•t</option>
                    <option>T√™n A-Z</option>
                </select> -->
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ng∆∞·ªùi d√πng</th>
                        <th>Email</th>
                        <th>Vai tr√≤</th>
                        <th>Ng√†y ƒëƒÉng k√Ω</th>
                        <!-- <th>Tr·∫°ng th√°i</th> -->
                        <th></th>
                    </tr>
                </thead>
                <tbody id="users-list-api">

                </tbody>
            </table>

            <div class="pagination">
                <button class="pagination-btn">¬´</button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">3</button>
                <button class="pagination-btn">¬ª</button>
            </div>
        </main>
    </div>

    <script>
        // Simple toggle for responsive sidebar
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });

    </script>



    <script>
        // H√†m ƒë·ªÉ t·∫£i v√† hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng
        function fetchUsers() {
            var apiUrl = 'https://localhost:7186/api/Users'; // API ƒë·ªÉ l·∫•y danh s√°ch ng∆∞·ªùi d√πng

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(users => {
                    if (!Array.isArray(users)) {
                        throw new Error("Invalid response format. Expected an array.");
                    }

                    // L∆∞u l·∫°i t·∫•t c·∫£ ng∆∞·ªùi d√πng ƒë·ªÉ ph·ª•c v·ª• cho t√¨m ki·∫øm v√† l·ªçc
                    let allUsers = users;

                    // L·∫Øng nghe s·ª± ki·ªán t√¨m ki·∫øm
                    document.getElementById('search-input').addEventListener('input', function () {
                        const searchQuery = this.value.toLowerCase();
                        const filteredUsers = allUsers.filter(user =>
                            user.username.toLowerCase().includes(searchQuery) ||  // T√¨m ki·∫øm theo t√™n ng∆∞·ªùi d√πng
                            user.email.toLowerCase().includes(searchQuery)        // T√¨m ki·∫øm theo email
                        );
                        displayUsers(filteredUsers); // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
                    });

                    // L·∫Øng nghe s·ª± ki·ªán l·ªçc theo vai tr√≤
                    document.getElementById('role-filter').addEventListener('change', function () {
                        const selectedRole = this.value.toLowerCase();
                        const filteredUsers = selectedRole ? allUsers.filter(user => user.roleName.toLowerCase() === selectedRole) : allUsers;
                        displayUsers(filteredUsers); // Hi·ªÉn th·ªã k·∫øt qu·∫£ l·ªçc theo vai tr√≤
                    });

                    // Hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng ban ƒë·∫ßu
                    displayUsers(allUsers);
                })
                .catch(error => {
                    console.error("Error fetching users:", error);
                    let testApiEl = document.getElementById('users-list-api');
                    if (testApiEl) {
                        testApiEl.innerHTML = `<p class="error-message">Failed to load users. Please try again later.</p>`;
                    }
                });
        }

        // H√†m hi·ªÉn th·ªã ng∆∞·ªùi d√πng v√†o b·∫£ng
        function displayUsers(users) {
            const html = users.map(user => `
        <tr>
            <td>${user.id}</td>
            <td>
                <div class="user-info">
                    <span>${user.username}</span>
                </div>
            </td>
            <td>${user.email}</td>
            <td><span class="role-badge role-${user.roleName.toLowerCase()}">${user.roleName}</span></td>
            <td>${new Date(user.createdAt).toLocaleDateString()}</td>
            <td class="action-buttons">
                <button class="action-btn view">Xem</button>
                <a class="action-btn edit" href="user-edit.html?id=${user.id}">S·ª≠a</a>
                <button class="action-btn lock">Kh√≥a</button>
            </td>
        </tr>
    `).join("");

            // G√°n d·ªØ li·ªáu v√†o b·∫£ng
            let testApiEl = document.getElementById('users-list-api');
            if (testApiEl) {
                testApiEl.innerHTML = html;
            }
        }

        // G·ªçi h√†m ƒë·ªÉ t·∫£i v√† hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi d√πng khi trang t·∫£i






        // H√†m ƒë·ªÉ l·∫•y c√°c vai tr√≤ t·ª´ API v√† ƒëi·ªÅn v√†o select

        fetchUsers();

    </script>

</body>

</html>