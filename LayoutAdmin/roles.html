<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/admin/movies.css" />
    <title>NOTFLEX Admin - Qu·∫£n l√Ω Vai tr√≤</title>

</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="menu-toggle">‚ò∞</div>
        <a href="dashboard.html" class="logo">NOTFLEX</a>
        <div class="header-title">Qu·∫£n l√Ω Vai tr√≤</div>
        <div class="user-menu">
            <a href="#">Admin</a>
            <a href="#">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-menu">
                <div class="menu-title">Qu·∫£n l√Ω n·ªôi dung</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fa fa-dashboard">üìä</i> Dashboard
                </a>
                <a href="movies.html" class="menu-item">
                    <i class="fa fa-film">üé¨</i> Phim
                </a>
                <a href="genres.html" class="menu-item">
                    <i class="fa fa-tags">üè∑Ô∏è</i> Th·ªÉ lo·∫°i
                </a>

                <div class="menu-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
                <a href="users.html" class="menu-item">
                    <i class="fa fa-users">üë•</i> Users
                </a>
                <a href="roles.html" class="menu-item active">
                    <i class="fa fa-lock">üîí</i> Role
                </a>

                <div class="menu-title">H·ªá th·ªëng</div>
                <a href="settings.html" class="menu-item">
                    <i class="fa fa-cog">‚öôÔ∏è</i> C√†i ƒë·∫∑t
                </a>
                <a href="statistics.html" class="menu-item">
                    <i class="fa fa-bar-chart">üìà</i> Th·ªëng k√™
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-title">
                <h1>Qu·∫£n l√Ω Vai tr√≤</h1>
                <button class="btn"><a href="role-add.html">Th√™m vai tr√≤ m·ªõi</a></button>
            </div>

            <div class="filters">
                <div class="search-box">
                    <i class="fa fa-search">üîç</i>
                    <input type="text" placeholder="T√¨m ki·∫øm vai tr√≤...">
                </div>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n vai tr√≤</th>
                        <th>S·ªë ng∆∞·ªùi d√πng</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="roles-list-api">

                </tbody>
            </table>
        </main>
    </div>

    <script>
        // Simple toggle for responsive sidebar
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });
    </script>

    <script>
        function fetchRoles() {
            var apiUrlRoles = 'https://localhost:7186/api/Roles'; // API ƒë·ªÉ l·∫•y danh s√°ch vai tr√≤
            var apiUrlUsers = 'https://localhost:7186/api/Users'; // API ƒë·ªÉ l·∫•y danh s√°ch ng∆∞·ªùi d√πng

            // L·∫•y danh s√°ch vai tr√≤
            fetch(apiUrlRoles)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(roles => {
                    if (!Array.isArray(roles)) {
                        throw new Error("Invalid response format. Expected an array of roles.");
                    }

                    // Sau khi l·∫•y danh s√°ch vai tr√≤, ta ti·∫øp t·ª•c l·∫•y danh s√°ch ng∆∞·ªùi d√πng
                    return fetch(apiUrlUsers)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(users => {
                            if (!Array.isArray(users)) {
                                throw new Error("Invalid response format. Expected an array of users.");
                            }

                            // T√≠nh s·ªë ng∆∞·ªùi d√πng cho m·ªói vai tr√≤
                            let roleCounts = roles.map(role => {
                                let count = users.filter(user => user.roleName === role.name).length;
                                return {
                                    ...role,
                                    userCount: count
                                };
                            });

                            // Hi·ªÉn th·ªã vai tr√≤ v·ªõi s·ªë ng∆∞·ªùi d√πng
                            var html = roleCounts.map(role => `
                        <tr>
                            <td>${role.id}</td>
                            <td><span class="role-badge role-admin">${role.name}</span></td>
                            <td>${role.userCount}</td> <!-- Hi·ªÉn th·ªã s·ªë ng∆∞·ªùi d√πng -->
                            <td class="action-buttons">
                                <button class="action-btn view">Xem ng∆∞·ªùi d√πng</button>
                                <button class="action-btn edit"><a href="role-edit.html">S·ª≠a</a></button>
                                <button class="action-btn delete">X√≥a</button>
                            </td>
                        </tr>
                    `).join("");

                            // G√°n d·ªØ li·ªáu v√†o ph·∫ßn t·ª≠ HTML n·∫øu t·ªìn t·∫°i
                            let testApiEl = document.getElementById('roles-list-api');
                            if (testApiEl) {
                                testApiEl.innerHTML = html;
                            } else {
                                console.error("Element with ID 'roles-list-api' not found.");
                            }
                        });
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                    let testApiEl = document.getElementById('roles-list-api');
                    if (testApiEl) {
                        testApiEl.innerHTML = `<p class="error-message">Failed to load data. Please try again later.</p>`;
                    }
                });
        }

        fetchRoles();



    </script>
</body>

</html>