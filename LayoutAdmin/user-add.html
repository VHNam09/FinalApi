<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/admin/movies.css" />
    <link rel="stylesheet" href="../assets/css/admin/users-add.css" />
    <title>NOTFLEX Admin - Th√™m Ng∆∞·ªùi d√πng</title>

</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="menu-toggle">‚ò∞</div>
        <a href="dashboard.html" class="logo">NOTFLEX</a>
        <div class="header-title">Th√™m Ng∆∞·ªùi d√πng</div>
        <div class="user-menu">
            <a href="#">Admin</a>
            <a href="#">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-menu">
                <div class="menu-title">Qu·∫£n l√Ω n·ªôi dung</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fa fa-dashboard">üìä</i> Dashboard
                </a>
                <a href="movies.html" class="menu-item">
                    <i class="fa fa-film">üé¨</i> Phim
                </a>
                <a href="genres.html" class="menu-item">
                    <i class="fa fa-tags">üè∑Ô∏è</i> Th·ªÉ lo·∫°i
                </a>

                <div class="menu-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
                <a href="users.html" class="menu-item active">
                    <i class="fa fa-users">üë•</i> Users
                </a>
                <a href="roles.html" class="menu-item">
                    <i class="fa fa-lock">üîí</i> Role
                </a>

                <div class="menu-title">H·ªá th·ªëng</div>
                <a href="settings.html" class="menu-item">
                    <i class="fa fa-cog">‚öôÔ∏è</i> C√†i ƒë·∫∑t
                </a>
                <a href="statistics.html" class="menu-item">
                    <i class="fa fa-bar-chart">üìà</i> Th·ªëng k√™
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-title">
                <h1>Th√™m Ng∆∞·ªùi d√πng m·ªõi</h1>
                <a href="users.html" class="btn btn-cancel">Quay l·∫°i danh s√°ch</a>
            </div>

            <div class="form-container">
                <div class="form-title">Th√¥ng tin ng∆∞·ªùi d√πng</div>
                <form id="addUserForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="username" class="required-field">T√™n ng∆∞·ªùi d√πng</label>
                            <input type="text" id="username" class="form-control" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi d√πng"
                                required>
                            <div id="username-error" class="error-message">Vui l√≤ng nh·∫≠p t√™n ƒëƒÉng nh·∫≠p</div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="required-field">Email</label>
                            <input type="email" id="email" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email"
                                required>
                            <div id="email-error" class="error-message">Vui l√≤ng nh·∫≠p email h·ª£p l·ªá</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="password" class="required-field">M·∫≠t kh·∫©u</label>
                            <input type="password" id="password" class="form-control" placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                                required>
                            <div id="password-error" class="error-message">M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±</div>
                        </div>
                        <!-- <div class="form-group">
                            <label for="confirmPassword" class="required-field">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                            <input type="password" id="confirmPassword" class="form-control"
                                placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required>
                            <div id="confirmPassword-error" class="error-message">M·∫≠t kh·∫©u kh√¥ng kh·ªõp</div>
                        </div> -->

                        <div class="form-group">
                            <label for="role" class="required-field">Vai tr√≤</label>
                            <select id="role" class="form-control" required>
                                <option value="1">Admin</option>
                                <!-- C√°c vai tr√≤ s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn v√†o ƒë√¢y t·ª´ API -->
                            </select>

                            <div id="role-error" class="error-message">Vui l√≤ng ch·ªçn vai tr√≤</div>
                        </div>


                    </div>



                    <div class="form-actions">
                        <button type="button" id="cancelButton" class="btn btn-cancel">H·ªßy</button>
                        <button type="submit" id="submitButton" class="btn btn-submit">Th√™m ng∆∞·ªùi d√πng</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        function addUser() {
            alert(role.id);
            const apiUrl = 'https://localhost:7186/api/Users';
            const usernameInput = document.getElementById('username');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const roleSelect = document.getElementById('role');
            const submitButton = document.getElementById('submitButton');

            // T·∫°o payload t·ª´ form
            const userData = {
                Username: usernameInput.value.trim(),
                Email: emailInput.value.trim(),
                Password: passwordInput.value,
                Role: parseInt(roleSelect.value),
            };

            // Disable n√∫t submit trong khi x·ª≠ l√Ω
            submitButton.disabled = true;
            submitButton.textContent = 'ƒêang x·ª≠ l√Ω...';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData)
            })
                .then(response => {
                    if (!response.ok) {
                        // Ki·ªÉm tra n·∫øu m√£ tr·∫°ng th√°i l√† 409 (Conflict)
                        if (response.status === 409) {
                            return response.json().then(err => {
                                throw new Error('Email ho·∫∑c t√™n ng∆∞·ªùi d√πng ƒë√£ t·ªìn t·∫°i.');
                            });
                        }

                        // Ki·ªÉm tra n·∫øu response c√≥ body ch·ª©a th√¥ng tin l·ªói
                        if (response.headers.get('Content-Type')?.includes('application/json')) {
                            return response.json().then(err => {
                                throw new Error(err.message || 'L·ªói x·∫£y ra');
                            });
                        }
                        // N·∫øu ph·∫£n h·ªìi kh√¥ng ph·∫£i JSON, tr·∫£ v·ªÅ m·ªôt l·ªói chung
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    // N·∫øu response ok v√† c√≥ body JSON
                    return response.json();
                })
                .then(data => {
                    alert('Th√™m ng∆∞·ªùi d√πng th√†nh c√¥ng!');
                    window.location.href = 'users.html';
                })
                .catch(error => {
                    console.error('Error:', error);

                    // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói chi ti·∫øt h∆°n
                    let errorMessage = 'C√≥ l·ªói x·∫£y ra khi th√™m ng∆∞·ªùi d√πng';
                    if (error.message) {
                        errorMessage = error.message;
                    }
                    if (error.errors) {
                        errorMessage = Object.values(error.errors).join('\n');
                    }

                    alert(errorMessage);
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Th√™m ng∆∞·ªùi d√πng';
                });
        }


        // G·∫Øn s·ª± ki·ªán cho form
        document.getElementById('addUserForm').addEventListener('submit', function (e) {
            e.preventDefault();
            addUser();
           
        });

        // X·ª≠ l√Ω n√∫t h·ªßy
        document.getElementById('cancelButton').addEventListener('click', function () {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy thao t√°c n√†y?')) {
                window.location.href = 'users.html';
            }
        });
    </script>




    <!-- <script>    
        // H√†m ƒë·ªÉ l·∫•y c√°c vai tr√≤ t·ª´ API v√† ƒëi·ªÅn v√†o select
        function loadRoles() {
            const apiUrl = 'https://localhost:7186/api/Roles'; // API l·∫•y danh s√°ch vai tr√≤
            
            const roleSelect = document.getElementById('role');

            // G·ª≠i y√™u c·∫ßu GET ƒë·ªÉ l·∫•y danh s√°ch vai tr√≤
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(roles => {
                    // X√≥a c√°c t√πy ch·ªçn c≈© trong select
                    roleSelect.innerHTML = '<option value="">Ch·ªçn vai tr√≤</option>';

                    // Duy·ªát qua danh s√°ch vai tr√≤ v√† th√™m v√†o th·∫ª select
                    roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.id;
                        option.textContent = role.name;
                        roleSelect.appendChild(option);
                       
                    });
                })
                .catch(error => {
                    console.error('Error loading roles:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i danh s√°ch vai tr√≤.');
                });
        }

        // G·ªçi h√†m loadRoles khi trang ƒë∆∞·ª£c t·∫£i
        loadRoles();

    </script> -->

    <!-- <script src="../assets/js/admin/users-add.js">

    </script> -->
</body>

</html>