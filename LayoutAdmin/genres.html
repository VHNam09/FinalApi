<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/admin/movies.css" />
    <title>NOTFLEX Admin - Qu·∫£n l√Ω Th·ªÉ lo·∫°i</title>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="menu-toggle">‚ò∞</div>
        <a href="dashboard.html" class="logo">NOTFLEX</a>
        <div class="header-title">Qu·∫£n l√Ω Th·ªÉ lo·∫°i</div>
        <div class="user-menu">
            <a href="#">Admin</a>
            <a href="#">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-menu">
                <div class="menu-title">Qu·∫£n l√Ω n·ªôi dung</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fa fa-dashboard">üìä</i> Dashboard
                </a>
                <a href="movies.html" class="menu-item">
                    <i class="fa fa-film">üé¨</i> Phim
                </a>
                <a href="genres.html" class="menu-item active">
                    <i class="fa fa-tags">üè∑Ô∏è</i> Th·ªÉ lo·∫°i
                </a>

                <div class="menu-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
                <a href="users.html" class="menu-item">
                    <i class="fa fa-users">üë•</i> Users
                </a>
                <a href="roles.html" class="menu-item">
                    <i class="fa fa-lock">üîí</i> Role
                </a>

                <div class="menu-title">H·ªá th·ªëng</div>
                <a href="settings.html" class="menu-item">
                    <i class="fa fa-cog">‚öôÔ∏è</i> C√†i ƒë·∫∑t
                </a>
                <a href="statistics.html" class="menu-item">
                    <i class="fa fa-bar-chart">üìà</i> Th·ªëng k√™
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-title">
                <h1>Qu·∫£n l√Ω Th·ªÉ lo·∫°i</h1>
                <button class="btn"><a href="genres-add.html">Th√™m th·ªÉ lo·∫°i m·ªõi</a></button>
            </div>

            <div class="filters">
                <div class="search-box">
                    <i class="fa fa-search">üîç</i>
                    <input type="text" placeholder="T√¨m ki·∫øm th·ªÉ lo·∫°i..." id="search-input">
                </div>
                <select class="filter-select" id="sort-select">
                    <option>S·∫Øp x·∫øp theo</option>
                    <option value="name">T√™n A-Z</option>
                    <option value="movieCount">S·ªë phim</option>
                    <option value="createdAt">Ng√†y t·∫°o</option>
                </select>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n th·ªÉ lo·∫°i</th>
                        <th>M√¥ t·∫£</th>
                        <th>S·ªë phim</th>
                        <th>Ng√†y t·∫°o</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="genre-api-list">


                </tbody>
            </table>

            <div class="pagination">
                <button class="pagination-btn">¬´</button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">¬ª</button>
            </div>
        </main>
    </div>

    <script>
        // Simple toggle for responsive sidebar
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });
    </script>

    <script>
        // H√†m g·ªçi API ƒë·ªÉ l·∫•y danh s√°ch th·ªÉ lo·∫°i v√† hi·ªÉn th·ªã trong b·∫£ng
        function fetchGenres() {
            var apiUrl = 'https://localhost:7186/api/Genres'; // URL c·ªßa API

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh ƒë·ªãnh d·∫°ng JSON
                })
                .then(genres => {
                    if (!Array.isArray(genres)) {
                        throw new Error("Invalid response format. Expected an array.");
                    }

                    // L∆∞u d·ªØ li·ªáu th·ªÉ lo·∫°i v√†o bi·∫øn ƒë·ªÉ x·ª≠ l√Ω sau
                    let allGenres = genres;

                    // G√°n d·ªØ li·ªáu v√†o ph·∫ßn t·ª≠ HTML v·ªõi ID 'genre-api-list'
                    let genreListEl = document.getElementById('genre-api-list');
                    if (genreListEl) {
                        displayGenres(allGenres); // Hi·ªÉn th·ªã d·ªØ li·ªáu ban ƒë·∫ßu
                    } else {
                        console.error("Element with ID 'genre-list' not found.");
                    }

                    // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi l·ª±a ch·ªçn s·∫Øp x·∫øp
                    document.getElementById('sort-select').addEventListener('change', function () {
                        const sortBy = this.value;
                        const sortedGenres = sortGenres(allGenres, sortBy);
                        displayGenres(sortedGenres); // Hi·ªÉn th·ªã d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
                    });

                    // L·∫Øng nghe s·ª± ki·ªán nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm
                    document.getElementById('search-input').addEventListener('input', function () {
                        const searchQuery = this.value.toLowerCase();
                        const filteredGenres = allGenres.filter(genre =>
                            genre.name.toLowerCase().includes(searchQuery) ||  // T√¨m ki·∫øm theo t√™n th·ªÉ lo·∫°i
                            genre.description.toLowerCase().includes(searchQuery)  // T√¨m ki·∫øm theo m√¥ t·∫£
                        );
                        displayGenres(filteredGenres); // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
                    });
                })
                .catch(error => {
                    console.error("Error fetching genres:", error);
                    let genreListEl = document.getElementById('genre-api-list');
                    if (genreListEl) {
                        genreListEl.innerHTML = `<p class="error-message">Failed to load genres. Please try again later.</p>`;
                    }
                });
        }

        // H√†m s·∫Øp x·∫øp th·ªÉ lo·∫°i
        function sortGenres(genres, sortBy) {
            return genres.sort((a, b) => {
                switch (sortBy) {
                    case "name":
                        return a.name.localeCompare(b.name); // S·∫Øp x·∫øp theo t√™n (A-Z)
                    case "movieCount":
                        return a.movieCount - b.movieCount; // S·∫Øp x·∫øp theo s·ªë phim
                    case "createdAt":
                        return new Date(a.createdAt) - new Date(b.createdAt); // S·∫Øp x·∫øp theo ng√†y t·∫°o
                    default:
                        return 0;
                }
            });
        }

        // H√†m ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch th·ªÉ lo·∫°i
        function displayGenres(genres) {
            const html = genres.map(genre => `
        <tr>
            <td>${genre.id}</td>
            <td>${genre.name}</td>
            <td>${genre.description}</td>
            <td>${genre.movieCount}</td>  <!-- S·ªë phim -->
            <td>${new Date(genre.createdAt).toLocaleDateString()}</td>  <!-- Ng√†y t·∫°o -->
            <td class="action-buttons">
                <button class="action-btn view">Xem</button>
                <a href="genres-edit.html?id=${genre.id}" class="action-btn edit">S·ª≠a</a>
                <button class="action-btn delete">X√≥a</button>
            </td>
        </tr>
    `).join("");

            // G√°n d·ªØ li·ªáu v√†o b·∫£ng
            let genreListEl = document.getElementById('genre-api-list');
            if (genreListEl) {
                genreListEl.innerHTML = html;
            }
        }

        // G·ªçi h√†m ƒë·ªÉ t·∫£i v√† hi·ªÉn th·ªã danh s√°ch th·ªÉ lo·∫°i khi trang t·∫£i
        fetchGenres();


    </script>
</body>

</html>