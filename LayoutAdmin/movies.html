<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/admin/movies.css" />
    <title>NOTFLEX Admin - Qu·∫£n l√Ω Phims</title>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="menu-toggle">‚ò∞</div>
        <a href="dashboard.html" class="logo">NOTFLEX</a>
        <div class="header-title">Qu·∫£n l√Ω Phim</div>
        <div class="user-menu">
            <a href="#">Admin</a>
            <a href="#">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-menu">
                <div class="menu-title">Qu·∫£n l√Ω n·ªôi dung</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fa fa-dashboard">üìä</i> Dashboard
                </a>
                <a href="movies.html" class="menu-item active">
                    <i class="fa fa-film">üé¨</i> Phim
                </a>
                <a href="genres.html" class="menu-item">
                    <i class="fa fa-tags">üè∑Ô∏è</i> Th·ªÉ lo·∫°i
                </a>

                <div class="menu-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
                <a href="users.html" class="menu-item">
                    <i class="fa fa-users">üë•</i> Users
                </a>
                <a href="roles.html" class="menu-item">
                    <i class="fa fa-lock">üîí</i> Role
                </a>

                <!-- <div class="menu-title">H·ªá th·ªëng</div>
                <a href="settings.html" class="menu-item">
                    <i class="fa fa-cog">‚öôÔ∏è</i> C√†i ƒë·∫∑t
                </a>
                <a href="statistics.html" class="menu-item">
                    <i class="fa fa-bar-chart">üìà</i> Th·ªëng k√™
                </a> -->
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-title">
                <h1>Qu·∫£n l√Ω Phim</h1>
                <button class="btn"><a href="movies-add.html">Th√™m Phim m·ªõi</a></button>
            </div>
            <div class="filters">
                <div class="search-box">
                    <i class="fa fa-search">üîç</i>
                    <input type="text" placeholder="T√¨m ki·∫øm phim...">
                </div>
                <div class="search-box" style="display: flex; align-items: center;">
                    <input type="number" id="yearInput" placeholder="Nh·∫≠p nƒÉm ph√°t h√†nh" />
                    <button
                        style=" height: 37.2px; width: 20%; background-color: black; color: rgb(237, 226, 226); font-weight: 600;"
                        onclick="filterByYear()">üîç</button>
                </div>
                <table class="data-table">
                    <select class="filter-select" id="genreSelect">

                    </select>
                    <select class="filter-select" id="sort-options">
                        <option>S·∫Øp x·∫øp theo</option>
                        <option value="newest">M·ªõi nh·∫•t</option>
                        <option value="Az">A-Z</option>

                    </select>
            </div>

            <thead>
                <tr>
                    <th>ID</th>
                    <th>Poster</th>
                    <th>T√™n phim</th>
                    <th>Th·ªÉ lo·∫°i</th>
                    <th>NƒÉm ph√°t h√†nh</th>
                    <th>ƒê·∫°o di·ªÖn</th>
                    <th>Th·ªùi l∆∞·ª£ng</th>
                    <th>Ng√†y t·∫°o</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody id="movies-list-api">
                <!--Hi·ªán phim ƒë·ªÉ th√™m s·ª≠a x√≥a-->
            </tbody>
            </table>

            <div class="pagination">
                <button class="pagination-btn">¬´</button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">3</button>
                <button class="pagination-btn">¬ª</button>
            </div>
        </main>
    </div>

    <script>
        // Simple toggle for responsive sidebar
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });
    </script>



    <script src="../assets/js/fetch.js"></script>

    <script>


        let selectedGenreId = "";
        let selectedSortOrder = "";

        // G·ªçi API v·ªõi b·ªô l·ªçc th·ªÉ lo·∫°i v√† s·∫Øp x·∫øp
        function fetchMovies() {
            let apiUrl = `https://localhost:7186/api/Movie/filtered-sorted?`;

            if (selectedGenreId) apiUrl += `genreId=${selectedGenreId}&`;
            if (selectedSortOrder) apiUrl += `sortOrder=${selectedSortOrder}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(movies => {
                    let moviesContainer = document.getElementById('movies-list-api');
                    if (moviesContainer) {
                        moviesContainer.innerHTML = movies.length ?
                            movies.map(movie => `
                     <tr>
                <td>${movie.id}</td>
                <td>
                    <img src="${movie.poster}" alt="${movie.title}" class="movie-thumbnail">
                </td>
                <td>${movie.title}</td>
                <td id="nameGenres">${movie.genreIds.join(", ")}</td> <!-- Chuy·ªÉn array genres th√†nh chu·ªói -->
                <td>${movie.releaseYear}</td>
                <td>${movie.director}</td>
                <td>${movie.duration} ph√∫t</td>
                <td>${new Date(movie.createdAt).toLocaleDateString()}</td> <!-- Format ng√†y cho ƒë·∫πp -->
                <td class="action-buttons">
                    <button class="action-btn view">Xem</button>
                    <button class="action-btn edit"><a href="movies-edit.html?id=${movie.id}" style="color: #3498db;">S·ª≠a</a></button>
                    <button class="action-btn delete" onclick="deleteMovie(${movie.id})">X√≥a</button>
                </td>
            </tr>
                        `).join("") :
                            `<p>Kh√¥ng c√≥ phim n√†o.</p>`;
                    }
                })
                .catch(error => console.error("L·ªói khi l·∫•y danh s√°ch phim:", error));
        }

        // C·∫≠p nh·∫≠t khi ch·ªçn th·ªÉ lo·∫°i
        document.getElementById('genreSelect').addEventListener('change', function () {
            selectedGenreId = this.value;
            fetchMovies();
        });

        // C·∫≠p nh·∫≠t khi ch·ªçn s·∫Øp x·∫øp
        document.getElementById("sort-options").addEventListener("change", function () {
            selectedSortOrder = this.value;
            fetchMovies();
        });

        // G·ªçi API khi trang t·∫£i l·∫ßn ƒë·∫ßu
        fetchMovies();

    </script>


</body>

</html>