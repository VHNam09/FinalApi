<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../assets/css/admin/movies.css" />
    <title>NOTFLEX Admin - Qu·∫£n l√Ω Phim DMM</title>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="menu-toggle">‚ò∞</div>
        <a href="dashboard.html" class="logo">NOTFLEX</a>
        <div class="header-title">Qu·∫£n l√Ω Phim</div>
        <div class="user-menu">
            <a href="#">Admin</a>
            <a href="#">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-menu">
                <div class="menu-title">Qu·∫£n l√Ω n·ªôi dung</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fa fa-dashboard">üìä</i> Dashboard
                </a>
                <a href="movies.html" class="menu-item active">
                    <i class="fa fa-film">üé¨</i> Phim
                </a>
                <a href="genres.html" class="menu-item">
                    <i class="fa fa-tags">üè∑Ô∏è</i> Th·ªÉ lo·∫°i
                </a>

                <div class="menu-title">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
                <a href="users.html" class="menu-item">
                    <i class="fa fa-users">üë•</i> Users
                </a>
                <a href="roles.html" class="menu-item">
                    <i class="fa fa-lock">üîí</i> Role
                </a>

                <div class="menu-title">H·ªá th·ªëng</div>
                <a href="settings.html" class="menu-item">
                    <i class="fa fa-cog">‚öôÔ∏è</i> C√†i ƒë·∫∑t
                </a>
                <a href="statistics.html" class="menu-item">
                    <i class="fa fa-bar-chart">üìà</i> Th·ªëng k√™
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-title">
                <h1>Qu·∫£n l√Ω Phim</h1>
                <button class="btn"><a href="movies-add.html">Th√™m phim m·ªõi</a></button>
            </div>

            <div class="filters">
                <div class="search-box" >
                    <i class="fa fa-search">üîç</i>
                    <input type="text" placeholder="T√¨m ki·∫øm phim...">
                </div>
                <select class="filter-select"  id="boxSearchs">
                    <option>T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                    <option>H√†nh ƒë·ªông</option>
                    <option>Ho·∫°t h√¨nh</option>
                    <option>T√¨nh c·∫£m</option>
                    <option>Kinh d·ªã</option>
                </select>
                <select class="filter-select">
                    <option>T·∫•t c·∫£ nƒÉm</option>
                    <option>2023</option>
                    <option>2022</option>
                    <option>2021</option>
                    <option>2020</option>
                </select>
                <select class="filter-select">
                    <option>S·∫Øp x·∫øp theo</option>
                    <option>M·ªõi nh·∫•t</option>
                    <option>NƒÉm ph√°t h√†nh</option>
                    <option>T√™n A-Z</option>
                </select>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Poster</th>
                        <th>T√™n phim</th>
                        <th>Th·ªÉ lo·∫°i</th>
                        <th>NƒÉm ph√°t h√†nh</th>
                        <th>ƒê·∫°o di·ªÖn</th>
                        <th>Th·ªùi l∆∞·ª£ng</th>
                        <th>Ng√†y t·∫°o</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="movies-list-api">
           <!--Hi·ªán phim ƒë·ªÉ th√™m s·ª≠a x√≥a-->
                </tbody>
            </table>

            <div class="pagination">
                <button class="pagination-btn">¬´</button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">3</button>
                <button class="pagination-btn">¬ª</button>
            </div>
        </main>
    </div>

    <script>
        // Simple toggle for responsive sidebar
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });
    </script>



<script src="../assets/js/fetch.js"></script>

<script>
        
function fetchMovies2() {
    var apiUrl = 'https://localhost:7186/api/Movie/with-genres'; // N√™n tr·ªè ƒë√∫ng route l·∫•y k√®m genres

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(movies => {
            if (!Array.isArray(movies)) {
                throw new Error("Invalid response format. Expected an array.");
            }

            var html1 = movies.map(movie => `
            <tr>
                <td>${movie.id}</td>
                <td>
                    <img src="${movie.poster}" alt="${movie.title}" class="movie-thumbnail">
                </td>
                <td>${movie.title}</td>
                <td>${movie.genreIds.join(", ")}</td> <!-- Chuy·ªÉn array genres th√†nh chu·ªói -->
                <td>${movie.releaseYear}</td>
                <td>${movie.director}</td>
                <td>${movie.duration} ph√∫t</td>
                <td>${new Date(movie.createdAt).toLocaleDateString()}</td> <!-- Format ng√†y cho ƒë·∫πp -->
                <td class="action-buttons">
                    <button class="action-btn view">Xem</button>
                    <button class="action-btn edit"><a href="movies-edit.html?id=${movie.id}">S·ª≠a</a></button>
                    <button class="action-btn delete" onclick="deleteMovie(${movie.id})">X√≥a</button>
                </td>
            </tr>
            `).join("");

            // G√°n d·ªØ li·ªáu v√†o ph·∫ßn t·ª≠ HTML n·∫øu t·ªìn t·∫°i
            let testApiEl = document.getElementById('movies-list-api');
            if (testApiEl) {
                testApiEl.innerHTML = html1;
            } else {
                console.error("Element with ID 'movies-list-api' not found.");
            }
        })
        .catch(error => {
            console.error("Error fetching movies:", error);
            let testApiEl = document.getElementById('movies-list-api');
            if (testApiEl) {
                testApiEl.innerHTML = `<p class="error-message">Failed to load movies. Please try again later.</p>`;
            }
        });
}

// G·ªçi h√†m ƒë·ªÉ l·∫•y danh s√°ch phim
fetchMovies2();




function fetchGenres() {
    var apiUrl = 'https://localhost:7186/api/Genres'; // N√™n tr·ªè ƒë√∫ng route l·∫•y k√®m genres

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(genress => {
            if (!Array.isArray(genress)) {
                throw new Error("Invalid response format. Expected an array.");
            }

            var html1 = genress.map(genress => `
            
                    <option>${genress.name}</option>
         
   
            `).join("");

            // G√°n d·ªØ li·ªáu v√†o ph·∫ßn t·ª≠ HTML n·∫øu t·ªìn t·∫°i
            let testApiEl = document.getElementById('boxSearchs');
            if (testApiEl) {
                testApiEl.innerHTML = html1;
            } else {
                console.error("Element with ID 'boxSearchs' not found.");
            }
        })
        .catch(error => {
            console.error("Error fetching genress:", error);
            let testApiEl = document.getElementById('boxSearchs');
            if (testApiEl) {
                testApiEl.innerHTML = `<p class="error-message">Failed to load movies. Please try again later.</p>`;
            }
        });
}

// G·ªçi h√†m ƒë·ªÉ l·∫•y danh s√°ch phim
fetchGenres();
</script>


</body>

</html>